cmake_minimum_required(VERSION 3.0)
project(tailorfs)
set(CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH} ${CMAKE_SOURCE_DIR}/dependency/.spack-env/view)
#message(${CMAKE_PREFIX_PATH})
set(CMAKE_CXX_STANDARD 14)
set(TAILORFS_CMAKE_DIR ${CMAKE_SOURCE_DIR}/CMake)
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${TAILORFS_CMAKE_DIR})
add_subdirectory(external/hcl)
find_package(unifyfs REQUIRED)
if (NOT ${UNIFYFS_FOUND})
    message(FATAL_ERROR "UnifyFS is needed for TailorFS build")
else()
    include_directories(${UNIFYFS_INCLUDE_DIRS})
endif()
find_package(MPI COMPONENTS CXX)
if (MPI_FOUND)
    message(STATUS "found mpi.h at ${MPI_CXX_INCLUDE_DIRS}")
endif ()
include_directories(${CMAKE_SOURCE_DIR}/src)

include_directories(${MPI_CXX_INCLUDE_DIRS})
add_executable(tailorfs main.cpp)
target_link_libraries(tailorfs ${UNIFYFS_API_LIBRARIES} ${MPI_CXX_LIBRARIES})

option(BUILD_TEST "Build the unit tests" ON)
if (BUILD_TEST)
    enable_testing()
    add_subdirectory(test)
endif ()

